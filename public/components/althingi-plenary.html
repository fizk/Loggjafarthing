<dom-module id="althingi-plenaries">
    <template>
        <althingi-pagination
                href="{{src}}"
                on-response="handleResponse"
                on-request="handleRequest"
                on-done="handleDone">
        </althingi-pagination>
        <althingi-preloader on-request-next="handleMore">
            <ul class="list list--simple">
                <template is="dom-repeat" items="{{plenaries}}">
                    <li class="list__item">
                        <althingi-plenary-badge
                                assembly="{{item.assembly_id}}"
                                from="{{item.from}}"
                                to="{{item.to}}"
                                name="{{item.name}}">
                        </althingi-plenary-badge>
                    </li>
                </template>
            </ul>
        </althingi-preloader>
    </template>
    <script>
        Polymer({
            id: 'althingi-plenaries',

            properties: {
                src: {
                    type: String,
                    computed: 'computeUrl(assembly)'
                },
                assembly: {
                    type: Number,
                    reflectToAttribute: true
                },

                plenaries: {
                    type: Array,
                    value: []
                }
            },

            computeUrl: function (assembly) {
                return '/api/loggjafarthing/' + assembly + '/thingfundir'
            },

            handleRequest: function (event) {
                this.querySelector('althingi-preloader').setAttribute('state', 'load');
            },

            handleResponse: function () {
                this.querySelector('althingi-preloader').setAttribute('state', 'halt');
                this.plenaries = this.plenaries.concat(event.detail);
            },

            handleMore: function (event) {
                this.querySelector('althingi-pagination').load();
            },

            handleDone: function (event) {
                this.querySelector('althingi-preloader').setAttribute('state', 'done');
            }
        })
    </script>
</dom-module>

<dom-module id="althingi-plenary-badge">
    <template>
        <article class="badge">
            <header class="badge__header">
                <h1 class="badge__title" on-click="handleGetItem">{{name}}</h1>
            </header>
            <div class="badge__body">
                <time class="badge__time">{{from}}</time>
                <time class="badge__time">{{to}}</time>
            </div>
            <footer></footer>
        </article>
    </template>

    <script>
        Polymer({
            is: 'althingi-plenary-badge',

            properties: {
                from: {
                    type: String,
                    reflectToAttribute: true
                },
                to: {
                    type: String,
                    reflectToAttribute: true
                },
                name: {
                    type: String,
                    reflectToAttribute: true
                },
                assembly: {
                    type: Number,
                    reflectToAttribute: true
                }
            },

            handleGetItem: function () {
                //this.fire('', {assembly: this.assembly});
            }
        })
    </script>
</dom-module>
