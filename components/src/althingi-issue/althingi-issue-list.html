<link rel="import" href="../../vendor/polymer/polymer.html" />
<link rel="import" href="../../vendor/neon-animation/neon-animatable-behavior.html">
<link rel="import" href="../../vendor/neon-animation/animations/slide-left-animation.html">
<link rel="import" href="../../vendor/neon-animation/animations/slide-right-animation.html">
<link rel="import" href="../../vendor/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../../vendor/neon-animation/animations/fade-out-animation.html">

<link rel="import" href="../althingi-pagination/althingi-pagination.html" />
<link rel="import" href="../althingi-preloader/althingi-preloader.html" />
<link rel="import" href="../althingi-issue/althingi-issue-badge.html" />

<!--
    ALTHINGI-ISSUE-LIST
    Will list all issues in a give assembly.
    This element will fetch all data via XHR

    This element is quite self contained. It will
    handle all it's fetching (in chunks) and pre-loading
    by its self. So this element is quite dumb. It will
    have children that are more clever and that
    can fire events to ask for context switch.

    @attribute assembly Number ID of assembly

-->
<dom-module id="althingi-issue-list">
    <template>
        <althingi-pagination
                id="althingiPagination"
                href="{{src}}"
                on-response="handleResponse"
                on-request="handleResquest"
                on-done="handleDone">
        </althingi-pagination>
        <althingi-preloader
                id="althingiPreloader"
                on-request-next="handleMore">
            <template is="dom-repeat" items="{{issues}}">
                <althingi-issue-badge
                        issue="{{item.issue_id}}"
                        assembly="{{item.assembly_id}}"
                        name="{{item.name}}"
                        status="{{item.status}}"
                        type="{{item.type_name}}">
                </althingi-issue-badge>
            </template>
        </althingi-preloader>
    </template>
    <script>
        Polymer({

            is: 'althingi-issue-list',

            properties: {
                assembly: {
                    type: String,
                    observer: 'changeAssembly'
                },
                src: {
                    type: String
                },

                issues: {
                    type: Array,
                    value: []
                },

                animationConfig: {
                    value: function () {
                        return {
                            entry: [{
                                name: 'slide-left-animation',
                                node: this
                            }, {
                                name: 'fade-in-animation',
                                node: this
                            }],
                            exit: [{
                                name: 'slide-right-animation',
                                node: this
                            }, {
                                name: 'fade-out-animation',
                                node: this
                            }]
                        }
                    }

                }
            },

            changeAssembly: function (newValue, oldValue) {
                this.issues = [];
                this.src = '/api/loggjafarthing/' + newValue + '/thingmal';
            },

            handleResquest: function (event) {
                this.$.althingiPreloader.setAttribute('state', 'load');
            },

            handleResponse: function (event) {
                this.$.althingiPreloader.setAttribute('state', 'halt');
                this.issues = this.issues.concat(event.detail);
            },

            handleMore: function (event) {
                this.$.althingiPagination.load();
            },

            handleDone: function (event) {
                this.$.althingiPreloader.setAttribute('state', 'done');
            }
        })
    </script>
</dom-module>
