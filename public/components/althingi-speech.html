<!--
    ALTHINGI-SPEECH-LIST
    This is a standalone element that will display
    speeches by given issue.

    This element will handle all data fetching and pagination
    via XHR requests.

    @attribute issue Number ID of issue
    @attribute assembly Number ID of assembly
-->
<dom-module id="althingi-speech-list">
    <template>
        <althingi-pagination
                href="{{href}}"
                on-response="handleResponse"
                on-request="handleRequest"
                on-done="handleDone">
        </althingi-pagination>
        <althingi-preloader on-request-next="handleMore">
            <ul>
                <template is="dom-repeat" items="{{speeches}}">
                    <li>
                        <article>
                            <header>
                                <althingi-congressman-badge
                                        congressman="{{item.congressman.congressman_id}}"
                                        name="{{item.congressman.name}}">
                                </althingi-congressman-badge>
                                <span>{{item.type}}</span>
                            </header>
                            <aside>
                                <dl>
                                    <dt>Raedutimi:</dt>
                                    <dd><time>{{item.time}}</time></dd>
                                    <dt>Yfirferd:</dt>
                                    <dd>{{item.iteration}}</dd>
                                </dl>

                            </aside>
                            <div>{{item.text}}</div>
                            <footer></footer>
                        </article>
                    </li>
                </template>
            </ul>
        </althingi-preloader>
    </template>
    <script>
        Polymer({

            is: "althingi-speech-list",

            properties: {
                issue: {
                    type: Number
                },
                assembly: {
                    type: Number
                },
                href: {
                    type: String
                },
                speeches: {
                    type: Array,
                    value: []
                }
            },

            observers: [
                'changeSpeeches(assembly, issue)'
            ],

            changeSpeeches: function(assembly, issue) {
                this.querySelector('althingi-preloader').reset();
                this.speeches = [];
                this.href = "/api/loggjafarthing/"+assembly+"/thingmal/"+issue+"/raedur";
            },

            handleResponse: function (event) {
                this.querySelector('althingi-preloader').setAttribute('state', 'halt');
                this.speeches = this.speeches.concat(event.detail);
            },

            handleRequest: function (event) {
                this.querySelector('althingi-preloader').setAttribute('state', 'load');
            },

            handleDone: function (event) {
                this.querySelector('althingi-preloader').setAttribute('state', 'done');
            },

            handleMore: function (event) {
                this.querySelector('althingi-pagination').load();
            }
        })
    </script>
</dom-module>
